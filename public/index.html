<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Monitor - Temperature and Humidity</title>
    <link rel="stylesheet" href="vendors/c3/c3.min.css">
    <script src="vendors/jquery/jquery.min.js"></script>
    <script src="vendors/d3/d3.min.js" ></script>
    <script src="vendors/c3/c3.min.js" charset="utf-8"></script>
</head>
<body>
<div id="chart"></div>
<script>
const from = new Date("2016-09-06 10:00");
const   to = new Date("2016-09-06 22:00");

var chart = c3.generate({
    bindto: '#chart',
    data: {
        x: "timestamp",
        columns: []
    },
    axis: {
        x: {
            type: 'timeseries',
            tick: {
                format: x => x.toTimeString().substr(0, 5),
                count: 24 + 1
            },
            padding: 0
        },
        y: {
            label: "Temperature",
            min: 0,
            max: 100,
            default: [ 0, 100 ],
            padding: 0
        },
        y2: {
            label: "Humidity %",
            show: true,
            min: 0,
            max: 100,
            default: [ 0, 100 ],
            padding: 0,
        }
    },
    subchart: {
        show: true
    },
    zoom: {
        enabled: true
    },
    point: {
        show: false
    }
});

$.ajax({
    url: "/api/sensor/dht11-living-room/data",
    data: {
        from: from.toJSON(),
        to: to.toJSON()
    }
}).then(rawData => {
    const data = {
        x: "timestamp",
        axes: {
            temperature: "y",
            humidity: "y2"
        },
        colors: {
            temperature: "red",
            humidity: "blue"
        },
        columns: [
            ["timestamp"],
            ["temperature"],
            ["humidity"]
        ],
        types: {
            temperature: "area",
            humidity: "area"
        }
    };
    rawData.forEach((row, i) => {
        data.columns[0].push(new Date(from * 1 + i * 60 * 1000));
        data.columns[1].push(row.temperature === Number.MIN_SAFE_INTEGER ? null : row.temperature);
        data.columns[2].push(row.humidity === Number.MIN_SAFE_INTEGER ? null : row.humidity);
    });
    chart.load(data);
});
</script>

</body>
</html>
